<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RifaMax - Sorteos en L√≠nea</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --secondary: #FFD23F;
            --accent: #00B4D8;
            --dark: #1a1a2e;
            --darker: #0f0f1e;
            --light: #ffffff;
            --success: #06FFA5;
            --danger: #FF5252;
            --purple: #9B5DE5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Fondo animado */
        .background-dots {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
            pointer-events: none;
        }

        .dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--secondary);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-30px) translateX(20px); }
            50% { transform: translateY(-60px) translateX(-20px); }
            75% { transform: translateY(-30px) translateX(20px); }
        }

        /* Header */
        header {
            position: relative;
            z-index: 10;
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 2px;
            cursor: pointer;
        }

        nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        nav a {
            color: var(--light);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.95rem;
        }

        nav a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--secondary);
            transition: width 0.3s ease;
        }

        nav a:hover::after {
            width: 100%;
        }

        .nav-buttons {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .btn-login {
            padding: 0.5rem 1.2rem;
            background: transparent;
            border: 2px solid var(--accent);
            border-radius: 25px;
            color: var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn-login:hover {
            background: var(--accent);
            color: var(--dark);
            transform: scale(1.05);
        }

        .btn-register {
            padding: 0.5rem 1.2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 25px;
            color: var(--dark);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .btn-register:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }

        /* Men√∫ de Usuario */
        .user-menu {
            position: relative;
            display: none;
        }

        .user-menu.active {
            display: block;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--dark);
            font-weight: 600;
            overflow: hidden;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.5);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: var(--dark);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 1rem;
            min-width: 280px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-dropdown-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 0.5rem;
        }

        .dropdown-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--secondary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--dark);
            overflow: hidden;
        }

        .dropdown-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dropdown-info h4 {
            font-size: 1rem;
            color: var(--secondary);
            margin-bottom: 0.2rem;
        }

        .dropdown-info p {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.7rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: rgba(255, 107, 53, 0.2);
        }

        .dropdown-item.admin {
            color: var(--purple);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .dropdown-item.logout {
            color: var(--danger);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 0.5rem;
            padding-top: 1rem;
        }

        .balance-badge {
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--dark);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        /* Hero */
        .hero {
            position: relative;
            z-index: 5;
            text-align: center;
            padding: 5rem 5% 3rem;
            animation: fadeIn 1s ease-out 0.3s backwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hero h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 4.5rem;
            line-height: 1;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 107, 53, 0.5)); }
            50% { filter: drop-shadow(0 0 40px rgba(255, 210, 63, 0.8)); }
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        .hero-features {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }

        .hero-feature {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem 2rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero-feature span {
            font-size: 2rem;
            display: block;
            margin-bottom: 0.5rem;
        }

        .cta-button {
            display: inline-block;
            padding: 1rem 3rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            border-radius: 50px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
            animation: pulse 2s ease-in-out infinite;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 107, 53, 0.6);
            animation: none;
        }

        /* Secciones */
        .section {
            position: relative;
            z-index: 5;
            padding: 3rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: 2px;
        }

        /* Grid de Rifas */
        .rifas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .rifa-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .rifa-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: 0 20px 60px rgba(255, 107, 53, 0.3);
        }

        .rifa-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }

        .rifa-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--success);
            color: var(--dark);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .rifa-content {
            padding: 1.5rem;
        }

        .rifa-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }

        .rifa-description {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }

        .rifa-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            color: var(--success);
        }

        .stat-label {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 1s ease;
        }

        .btn-participar {
            width: 100%;
            padding: 0.9rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--dark);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-participar:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.5);
        }

        .btn-participar:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Ganadores */
        .ganadores-list {
            display: grid;
            gap: 1rem;
        }

        .ganador-item {
            background: rgba(6, 255, 165, 0.1);
            border: 1px solid var(--success);
            border-radius: 15px;
            padding: 1.2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .ganador-icon {
            font-size: 2.5rem;
        }

        .ganador-info {
            flex: 1;
        }

        .ganador-nombre {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .ganador-premio {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--dark);
            border: 2px solid var(--primary);
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.8rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--secondary);
            text-align: center;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group label .required {
            color: var(--danger);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--light);
            font-family: 'Poppins', sans-serif;
            font-size: 0.95rem;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .phone-input {
            display: flex;
            gap: 0.5rem;
        }

        .phone-input select {
            width: 120px;
            flex-shrink: 0;
        }

        .phone-input input {
            flex: 1;
        }

        .form-hint {
            font-size: 0.75rem;
            opacity: 0.6;
            margin-top: 0.3rem;
        }

        .btn-submit {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--dark);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.5rem;
        }

        .btn-submit:hover {
            transform: scale(1.02);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .form-link {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .form-link a {
            color: var(--accent);
            cursor: pointer;
            text-decoration: underline;
        }

        .referido-section {
            background: rgba(155, 93, 229, 0.1);
            border: 1px solid var(--purple);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.2rem;
        }

        .referido-section label {
            color: var(--purple);
        }

        /* Perfil */
        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 3px solid var(--primary);
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--dark);
            position: relative;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-avatar .edit-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 0.3rem;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .profile-avatar:hover .edit-overlay {
            opacity: 1;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .profile-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
        }

        .profile-stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            color: var(--success);
        }

        .profile-stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .referral-box {
            background: linear-gradient(135deg, rgba(155, 93, 229, 0.2), rgba(0, 180, 216, 0.2));
            border: 1px solid var(--purple);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .referral-box h4 {
            color: var(--purple);
            margin-bottom: 0.5rem;
        }

        .referral-code {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 5px;
            color: var(--secondary);
            background: rgba(0, 0, 0, 0.3);
            padding: 0.5rem 1.5rem;
            border-radius: 10px;
            display: inline-block;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .referral-code:hover {
            transform: scale(1.05);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .referral-stat {
            text-align: center;
        }

        .referral-stat-value {
            font-weight: 700;
            color: var(--success);
            font-size: 1.2rem;
        }

        .referral-stat-label {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        /* Panel Admin */
        .admin-panel {
            display: none;
            position: relative;
            z-index: 5;
            padding: 2rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .admin-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .admin-tab {
            padding: 0.8rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .admin-tab.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .admin-tab:hover {
            background: rgba(255, 107, 53, 0.3);
        }

        .admin-content {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.2rem;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--success);
        }

        .stat-card-label {
            opacity: 0.8;
            font-size: 0.85rem;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .admin-table th,
        .admin-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-table th {
            background: rgba(0, 0, 0, 0.3);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .btn-small {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            margin-right: 0.3rem;
        }

        .btn-edit { background: var(--accent); color: var(--dark); }
        .btn-toggle { background: var(--secondary); color: var(--dark); }
        .btn-delete { background: var(--danger); color: var(--light); }

        .btn-nuevo {
            padding: 0.8rem 1.5rem;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: var(--dark);
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-active { background: rgba(6, 255, 165, 0.2); color: var(--success); }
        .status-inactive { background: rgba(255, 82, 82, 0.2); color: var(--danger); }

        /* Boletos Selector */
        .boletos-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .btn-cantidad {
            width: 45px;
            height: 45px;
            background: var(--primary);
            color: var(--light);
            border: none;
            border-radius: 10px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-cantidad:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .cantidad-display {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            min-width: 60px;
            text-align: center;
        }

        /* Footer */
        footer {
            position: relative;
            z-index: 5;
            text-align: center;
            padding: 2rem 5%;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 3rem;
        }

        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 1rem 1.5rem;
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
        }

        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            header { flex-direction: column; gap: 1rem; }
            nav { flex-wrap: wrap; justify-content: center; }
            .hero h1 { font-size: 2.8rem; }
            .form-row { grid-template-columns: 1fr; }
            .rifas-grid { grid-template-columns: 1fr; }
        }

        .auth-buttons.hidden { display: none; }
    </style>
</head>
<body>
    <div class="background-dots" id="dots"></div>

    <!-- Header -->
    <header>
        <div class="logo" onclick="irInicio()">RIFAMAX</div>
        <nav>
            <a href="#rifas">Rifas</a>
            <a href="#ganadores">Ganadores</a>
            <a href="#como-funciona">¬øC√≥mo funciona?</a>
            
            <div class="nav-buttons auth-buttons" id="authButtons">
                <button class="btn-login" onclick="abrirModal('modalLogin')">Iniciar Sesi√≥n</button>
                <button class="btn-register" onclick="abrirModal('modalRegistro')">Registrarse</button>
            </div>

            <div class="user-menu" id="userMenu">
                <div class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">
                    <span id="avatarContent">üë§</span>
                </div>
                <div class="user-dropdown" id="userDropdown">
                    <div class="user-dropdown-header">
                        <div class="dropdown-avatar" id="dropdownAvatar">
                            <span id="dropdownAvatarContent">üë§</span>
                        </div>
                        <div class="dropdown-info">
                            <h4 id="dropdownUserName">Usuario</h4>
                            <p id="dropdownUserEmail">email@ejemplo.com</p>
                        </div>
                    </div>
                    <div class="dropdown-item" onclick="abrirModal('modalPerfil')">
                        <span>üë§</span> Mi Perfil
                    </div>
                    <div class="dropdown-item" onclick="abrirModal('modalEstadisticas')">
                        <span>üìä</span> Mis Estad√≠sticas
                    </div>
                    <div class="dropdown-item" onclick="abrirModal('modalMisBoletos')">
                        <span>üéüÔ∏è</span> Mis Boletos
                    </div>
                    <div class="dropdown-item" onclick="abrirModal('modalReferidos')">
                        <span>ü§ù</span> Mis Referidos
                        <span class="balance-badge" id="balanceReferidos">$0.00</span>
                    </div>
                    <div class="dropdown-item admin" id="adminMenuItem" style="display: none;" onclick="mostrarPanelAdmin()">
                        <span>‚öôÔ∏è</span> Panel Admin
                    </div>
                    <div class="dropdown-item logout" onclick="cerrarSesion()">
                        <span>üö™</span> Cerrar Sesi√≥n
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main id="mainContent">
        <section class="hero" id="heroSection">
            <h1>¬°TU SUERTE EMPIEZA AQU√ç!</h1>
            <p>Participa en las rifas m√°s emocionantes y gana premios incre√≠bles</p>
            <div class="hero-features">
                <div class="hero-feature">
                    <span>üéüÔ∏è</span>
                    <strong>$1 USD</strong>
                    <small>por boleto</small>
                </div>
                <div class="hero-feature">
                    <span>üí∞</span>
                    <strong>$100 USD</strong>
                    <small>premio</small>
                </div>
                <div class="hero-feature">
                    <span>ü§ù</span>
                    <strong>$0.10</strong>
                    <small>por referido</small>
                </div>
            </div>
            <button class="cta-button" onclick="abrirModal('modalRegistro')">¬°Participa Ahora!</button>
        </section>

        <section class="section" id="rifas">
            <h2 class="section-title">üé∞ Rifas Activas</h2>
            <div class="rifas-grid" id="rifasGrid">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </section>

        <section class="section" id="ganadores">
            <h2 class="section-title">üèÜ Ganadores Recientes</h2>
            <div class="ganadores-list" id="ganadoresList">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </section>

        <section class="section" id="como-funciona">
            <h2 class="section-title">üìñ ¬øC√≥mo Funciona?</h2>
            <div class="rifas-grid">
                <div class="rifa-card">
                    <div class="rifa-content" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">1Ô∏è‚É£</div>
                        <h3 style="color: var(--secondary); margin-bottom: 0.5rem;">Reg√≠strate</h3>
                        <p style="opacity: 0.8;">Crea tu cuenta gratis y obt√©n tu c√≥digo de referido √∫nico.</p>
                    </div>
                </div>
                <div class="rifa-card">
                    <div class="rifa-content" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">2Ô∏è‚É£</div>
                        <h3 style="color: var(--secondary); margin-bottom: 0.5rem;">Compra Boletos</h3>
                        <p style="opacity: 0.8;">Cada boleto cuesta solo $1 USD. ¬°Compra los que quieras!</p>
                    </div>
                </div>
                <div class="rifa-card">
                    <div class="rifa-content" style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">3Ô∏è‚É£</div>
                        <h3 style="color: var(--secondary); margin-bottom: 0.5rem;">¬°Gana!</h3>
                        <p style="opacity: 0.8;">Espera el sorteo y gana hasta $100 USD. ¬°As√≠ de f√°cil!</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Admin Panel -->
    <section class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h2 class="section-title" style="margin: 0;">‚öôÔ∏è Panel de Administraci√≥n</h2>
            <button class="btn-login" onclick="cerrarPanelAdmin()">‚Üê Volver al Sitio</button>
        </div>
        <div class="admin-tabs">
            <div class="admin-tab active" onclick="cambiarTabAdmin('dashboard')">Dashboard</div>
            <div class="admin-tab" onclick="cambiarTabAdmin('rifas')">Rifas</div>
            <div class="admin-tab" onclick="cambiarTabAdmin('usuarios')">Usuarios</div>
            <div class="admin-tab" onclick="cambiarTabAdmin('compras')">Compras</div>
        </div>
        <div class="admin-content">
            <div id="tabDashboard" class="admin-tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="adminTotalUsuarios">0</div>
                        <div class="stat-card-label">Usuarios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="adminTotalRifas">0</div>
                        <div class="stat-card-label">Rifas Activas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="adminTotalBoletos">0</div>
                        <div class="stat-card-label">Boletos Vendidos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="adminTotalIngresos">$0</div>
                        <div class="stat-card-label">Ingresos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="adminTotalReferidos">$0</div>
                        <div class="stat-card-label">Comisiones</div>
                    </div>
                </div>
            </div>
            <div id="tabRifas" class="admin-tab-content" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Gesti√≥n de Rifas</h3>
                    <button class="btn-nuevo" onclick="abrirModal('modalNuevaRifa')">+ Nueva Rifa</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="admin-table"><thead><tr><th>T√≠tulo</th><th>Premio</th><th>Boletos</th><th>Estado</th><th>Acciones</th></tr></thead><tbody id="rifasAdminBody"></tbody></table>
                </div>
            </div>
            <div id="tabUsuarios" class="admin-tab-content" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Usuarios</h3>
                <div style="overflow-x: auto;">
                    <table class="admin-table"><thead><tr><th>Nombre</th><th>Email</th><th>Tel√©fono</th><th>Referidos</th><th>Registro</th></tr></thead><tbody id="usuariosAdminBody"></tbody></table>
                </div>
            </div>
            <div id="tabCompras" class="admin-tab-content" style="display: none;">
                <h3 style="margin-bottom: 1rem;">Compras</h3>
                <div style="overflow-x: auto;">
                    <table class="admin-table"><thead><tr><th>Usuario</th><th>Rifa</th><th>Boletos</th><th>Total</th><th>Referidor</th><th>Fecha</th></tr></thead><tbody id="comprasAdminBody"></tbody></table>
                </div>
            </div>
        </div>
    </section>

    <!-- Modales -->
    <div class="modal" id="modalLogin">
        <div class="modal-content" style="max-width: 400px;">
            <button class="modal-close" onclick="cerrarModal('modalLogin')">√ó</button>
            <h3 class="modal-title">üîê Iniciar Sesi√≥n</h3>
            <form onsubmit="iniciarSesion(event)">
                <div class="form-group">
                    <label>Correo Electr√≥nico <span class="required">*</span></label>
                    <input type="email" id="loginEmail" required placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Contrase√±a <span class="required">*</span></label>
                    <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="submit" class="btn-submit" id="btnLogin">Iniciar Sesi√≥n</button>
            </form>
            <div class="form-link">¬øNo tienes cuenta? <a onclick="cambiarModal('modalLogin', 'modalRegistro')">Reg√≠strate aqu√≠</a></div>
        </div>
    </div>

    <div class="modal" id="modalRegistro">
        <div class="modal-content">
            <button class="modal-close" onclick="cerrarModal('modalRegistro')">√ó</button>
            <h3 class="modal-title">üìù Crear Cuenta</h3>
            <form onsubmit="registrarUsuario(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nombre <span class="required">*</span></label>
                        <input type="text" id="regNombre" required placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label>Apellido <span class="required">*</span></label>
                        <input type="text" id="regApellido" required placeholder="Tu apellido">
                    </div>
                </div>
                <div class="form-group">
                    <label>Correo Electr√≥nico <span class="required">*</span></label>
                    <input type="email" id="regEmail" required placeholder="tu@email.com">
                </div>
                <div class="form-group">
                    <label>Confirmar Correo <span class="required">*</span></label>
                    <input type="email" id="regEmailConfirm" required placeholder="Confirma tu correo">
                </div>
                <div class="form-group">
                    <label>Tel√©fono <span class="required">*</span></label>
                    <div class="phone-input">
                        <select id="regCodigoPais">
                            <option value="+1">üá∫üá∏ +1</option>
                            <option value="+52">üá≤üáΩ +52</option>
                            <option value="+54">üá¶üá∑ +54</option>
                            <option value="+55">üáßüá∑ +55</option>
                            <option value="+56">üá®üá± +56</option>
                            <option value="+57">üá®üá¥ +57</option>
                            <option value="+58">üáªüá™ +58</option>
                            <option value="+34">üá™üá∏ +34</option>
                            <option value="+51">üáµüá™ +51</option>
                            <option value="+593">üá™üá® +593</option>
                            <option value="+598">üá∫üáæ +598</option>
                        </select>
                        <input type="tel" id="regTelefono" required placeholder="N√∫mero">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Contrase√±a <span class="required">*</span></label>
                        <input type="password" id="regPassword" required placeholder="M√≠n. 6 caracteres" minlength="6">
                    </div>
                    <div class="form-group">
                        <label>Confirmar <span class="required">*</span></label>
                        <input type="password" id="regPasswordConfirm" required placeholder="Confirmar">
                    </div>
                </div>
                <div class="referido-section">
                    <div class="form-group" style="margin: 0;">
                        <label>üéÅ C√≥digo de Referido (opcional)</label>
                        <input type="text" id="regCodigoReferido" placeholder="Ej: ABC123" maxlength="6" style="text-transform: uppercase;">
                        <p class="form-hint">Si alguien te invit√≥, ingresa su c√≥digo</p>
                    </div>
                </div>
                <button type="submit" class="btn-submit" id="btnRegistro">Crear Cuenta</button>
            </form>
            <div class="form-link">¬øYa tienes cuenta? <a onclick="cambiarModal('modalRegistro', 'modalLogin')">Inicia sesi√≥n</a></div>
        </div>
    </div>

    <div class="modal" id="modalPerfil">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="cerrarModal('modalPerfil')">√ó</button>
            <h3 class="modal-title">üë§ Mi Perfil</h3>
            <div class="profile-header">
                <div class="profile-avatar" id="profileAvatar" onclick="document.getElementById('avatarInput').click()">
                    <span id="profileAvatarContent">üë§</span>
                    <div class="edit-overlay">üì∑ Cambiar</div>
                </div>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="cambiarAvatar(event)">
                <h3 id="profileNombreCompleto">Usuario</h3>
                <p style="opacity: 0.7;" id="profileEmail">email@ejemplo.com</p>
            </div>
            <form onsubmit="actualizarPerfil(event)">
                <div class="form-row">
                    <div class="form-group"><label>Nombre</label><input type="text" id="editNombre"></div>
                    <div class="form-group"><label>Apellido</label><input type="text" id="editApellido"></div>
                </div>
                <div class="form-group"><label>Tel√©fono</label><input type="tel" id="editTelefono" readonly style="opacity: 0.6;"></div>
                <button type="submit" class="btn-submit">Guardar Cambios</button>
            </form>
        </div>
    </div>

    <div class="modal" id="modalEstadisticas">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="cerrarModal('modalEstadisticas')">√ó</button>
            <h3 class="modal-title">üìä Mis Estad√≠sticas</h3>
            <div class="profile-stats">
                <div class="profile-stat"><div class="profile-stat-value" id="statBoletosComprados">0</div><div class="profile-stat-label">Boletos</div></div>
                <div class="profile-stat"><div class="profile-stat-value" id="statDineroGastado">$0</div><div class="profile-stat-label">Gastado</div></div>
                <div class="profile-stat"><div class="profile-stat-value" id="statRifasParticipadas">0</div><div class="profile-stat-label">Rifas</div></div>
                <div class="profile-stat"><div class="profile-stat-value" id="statPremiosGanados">0</div><div class="profile-stat-label">Premios</div></div>
            </div>
        </div>
    </div>

    <div class="modal" id="modalMisBoletos">
        <div class="modal-content">
            <button class="modal-close" onclick="cerrarModal('modalMisBoletos')">√ó</button>
            <h3 class="modal-title">üéüÔ∏è Mis Boletos</h3>
            <div id="listaMisBoletos"><p style="text-align: center; opacity: 0.7;">No tienes boletos a√∫n</p></div>
        </div>
    </div>

    <div class="modal" id="modalReferidos">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="cerrarModal('modalReferidos')">√ó</button>
            <h3 class="modal-title">ü§ù Mis Referidos</h3>
            <div class="referral-box">
                <h4>Tu C√≥digo de Referido</h4>
                <div class="referral-code" id="miCodigoReferido" onclick="copiarCodigoReferido()">------</div>
                <p style="font-size: 0.8rem; opacity: 0.7;">Click para copiar</p>
                <div class="referral-stats">
                    <div class="referral-stat"><div class="referral-stat-value" id="totalReferidos">0</div><div class="referral-stat-label">Referidos</div></div>
                    <div class="referral-stat"><div class="referral-stat-value" id="boletosReferidos">0</div><div class="referral-stat-label">Sus Boletos</div></div>
                    <div class="referral-stat"><div class="referral-stat-value" id="dineroReferidos">$0.00</div><div class="referral-stat-label">Ganado</div></div>
                </div>
            </div>
            <p style="text-align: center; font-size: 0.85rem; opacity: 0.8;">Gana <strong style="color: var(--success);">$0.10 USD</strong> por cada boleto de tus referidos</p>
        </div>
    </div>

    <div class="modal" id="modalParticipar">
        <div class="modal-content" style="max-width: 400px;">
            <button class="modal-close" onclick="cerrarModal('modalParticipar')">√ó</button>
            <h3 class="modal-title" id="modalParticiparTitle">üéüÔ∏è Comprar Boletos</h3>
            <div style="text-align: center; margin-bottom: 1.5rem;"><p style="opacity: 0.8;">Precio: <strong style="color: var(--success);">$1 USD</strong></p></div>
            <div class="boletos-selector">
                <button type="button" class="btn-cantidad" onclick="cambiarCantidadBoletos(-1)">‚àí</button>
                <div class="cantidad-display" id="cantidadBoletosDisplay">1</div>
                <button type="button" class="btn-cantidad" onclick="cambiarCantidadBoletos(1)">+</button>
            </div>
            <div style="text-align: center; margin: 1.5rem 0;">
                <p>Total:</p>
                <p style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--secondary);" id="totalPagarBoletos">$1.00</p>
            </div>
            <button class="btn-submit" onclick="confirmarCompra()" id="btnConfirmarCompra">Confirmar Compra</button>
        </div>
    </div>

    <div class="modal" id="modalNuevaRifa">
        <div class="modal-content">
            <button class="modal-close" onclick="cerrarModal('modalNuevaRifa')">√ó</button>
            <h3 class="modal-title" id="modalRifaTitle">‚ûï Nueva Rifa</h3>
            <form onsubmit="guardarRifa(event)">
                <div class="form-group"><label>T√≠tulo <span class="required">*</span></label><input type="text" id="rifaTitulo" required placeholder="Ej: iPhone 15 Pro"></div>
                <div class="form-group"><label>Descripci√≥n</label><textarea id="rifaDescripcion" placeholder="Descripci√≥n..."></textarea></div>
                <div class="form-row">
                    <div class="form-group"><label>√çcono</label><input type="text" id="rifaIcono" value="üéÅ"></div>
                    <div class="form-group"><label>Premio (USD)</label><input type="number" id="rifaPremio" value="100" min="1"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Total Boletos</label><input type="number" id="rifaTotalBoletos" value="100" min="10"></div>
                    <div class="form-group"><label>D√≠as</label><input type="number" id="rifaDias" value="7" min="1"></div>
                </div>
                <button type="submit" class="btn-submit">Guardar Rifa</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 RifaMax. Todos los derechos reservados.</p>
        <p style="opacity: 0.7; margin-top: 0.5rem;">Juega responsablemente. Mayores de 18 a√±os.</p>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
        // Config
        const firebaseConfig = {
            apiKey: "AIzaSyBrr8F9G93klUb-8Kk7fgmJ7t1D6ObRXic",
            authDomain: "rifamax.firebaseapp.com",
            projectId: "rifamax",
            storageBucket: "rifamax.firebasestorage.app",
            messagingSenderId: "916004942628",
            appId: "1:916004942628:web:02a27ba494358860f739b1"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();

        // Constants
        const ADMIN_EMAIL = 'fabricio9061@gmail.com';
        const PRECIO_BOLETO = 1;
        const COMISION_REFERIDO = 0.10;

        // State
        let currentUser = null;
        let userData = null;
        let rifas = [];
        let rifaSeleccionada = null;
        let cantidadBoletos = 1;
        let rifaEditando = null;

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            crearFondo();
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await cargarDatosUsuario();
                    actualizarUIUsuario();
                } else {
                    currentUser = null;
                    userData = null;
                    actualizarUIUsuario();
                }
            });
            cargarRifas();
            cargarGanadores();
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('userMenu');
                if (userMenu && !userMenu.contains(e.target)) {
                    document.getElementById('userDropdown').classList.remove('show');
                }
            });
        });

        function crearFondo() {
            const container = document.getElementById('dots');
            for (let i = 0; i < 50; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = Math.random() * 100 + '%';
                dot.style.top = Math.random() * 100 + '%';
                dot.style.animationDelay = Math.random() * 20 + 's';
                container.appendChild(dot);
            }
        }

        // Auth
        async function registrarUsuario(e) {
            e.preventDefault();
            const nombre = document.getElementById('regNombre').value.trim();
            const apellido = document.getElementById('regApellido').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const emailConfirm = document.getElementById('regEmailConfirm').value.trim().toLowerCase();
            const codigoPais = document.getElementById('regCodigoPais').value;
            const telefono = document.getElementById('regTelefono').value.trim();
            const password = document.getElementById('regPassword').value;
            const passwordConfirm = document.getElementById('regPasswordConfirm').value;
            const codigoReferido = document.getElementById('regCodigoReferido').value.trim().toUpperCase();

            if (email !== emailConfirm) { mostrarToast('Los correos no coinciden', 'error'); return; }
            if (password !== passwordConfirm) { mostrarToast('Las contrase√±as no coinciden', 'error'); return; }

            const btn = document.getElementById('btnRegistro');
            btn.disabled = true;
            btn.textContent = 'Creando...';

            try {
                let referidorId = null;
                if (codigoReferido) {
                    const refQuery = await db.collection('usuarios').where('codigoReferido', '==', codigoReferido).get();
                    if (refQuery.empty) { mostrarToast('C√≥digo de referido inv√°lido', 'error'); btn.disabled = false; btn.textContent = 'Crear Cuenta'; return; }
                    referidorId = refQuery.docs[0].id;
                }

                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const miCodigoReferido = generarCodigoReferido();

                await db.collection('usuarios').doc(userCredential.user.uid).set({
                    nombre, apellido, email,
                    telefono: codigoPais + telefono,
                    codigoReferido: miCodigoReferido,
                    referidoPor: referidorId,
                    avatarUrl: null,
                    totalReferidos: 0,
                    boletosDeReferidos: 0,
                    dineroDeReferidos: 0,
                    fechaRegistro: firebase.firestore.FieldValue.serverTimestamp(),
                    esAdmin: email === ADMIN_EMAIL
                });

                if (referidorId) {
                    await db.collection('usuarios').doc(referidorId).update({
                        totalReferidos: firebase.firestore.FieldValue.increment(1)
                    });
                }

                cerrarModal('modalRegistro');
                mostrarToast('¬°Cuenta creada!', 'success');
            } catch (error) {
                let msg = 'Error al crear cuenta';
                if (error.code === 'auth/email-already-in-use') msg = 'Correo ya registrado';
                mostrarToast(msg, 'error');
            }
            btn.disabled = false;
            btn.textContent = 'Crear Cuenta';
        }

        async function iniciarSesion(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('btnLogin');
            btn.disabled = true;
            btn.textContent = 'Entrando...';

            try {
                await auth.signInWithEmailAndPassword(email, password);
                cerrarModal('modalLogin');
                mostrarToast('¬°Bienvenido!', 'success');
            } catch (error) {
                mostrarToast('Correo o contrase√±a incorrectos', 'error');
            }
            btn.disabled = false;
            btn.textContent = 'Iniciar Sesi√≥n';
        }

        async function cerrarSesion() {
            await auth.signOut();
            cerrarPanelAdmin();
            document.getElementById('userDropdown').classList.remove('show');
            mostrarToast('Sesi√≥n cerrada', 'success');
        }

        async function cargarDatosUsuario() {
            if (!currentUser) return;
            const doc = await db.collection('usuarios').doc(currentUser.uid).get();
            if (doc.exists) userData = { id: doc.id, ...doc.data() };
        }

        function actualizarUIUsuario() {
            const authButtons = document.getElementById('authButtons');
            const userMenu = document.getElementById('userMenu');
            const adminMenuItem = document.getElementById('adminMenuItem');

            if (currentUser && userData) {
                authButtons.classList.add('hidden');
                userMenu.classList.add('active');
                const inicial = userData.nombre ? userData.nombre.charAt(0).toUpperCase() : 'üë§';
                const avatarContent = userData.avatarUrl ? `<img src="${userData.avatarUrl}">` : inicial;
                document.getElementById('avatarContent').innerHTML = avatarContent;
                document.getElementById('dropdownAvatarContent').innerHTML = avatarContent;
                document.getElementById('dropdownUserName').textContent = `${userData.nombre} ${userData.apellido}`;
                document.getElementById('dropdownUserEmail').textContent = userData.email;
                adminMenuItem.style.display = (userData.esAdmin || userData.email === ADMIN_EMAIL) ? 'flex' : 'none';
                actualizarBalanceReferidos();
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.remove('active');
            }
        }

        async function actualizarBalanceReferidos() {
            if (!currentUser) return;
            const comprasQuery = await db.collection('compras').where('referidorId', '==', currentUser.uid).get();
            let totalBoletos = 0;
            comprasQuery.forEach(doc => totalBoletos += doc.data().cantidad || 0);
            document.getElementById('balanceReferidos').textContent = `$${(totalBoletos * COMISION_REFERIDO).toFixed(2)}`;
        }

        function generarCodigoReferido() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let codigo = '';
            for (let i = 0; i < 6; i++) codigo += chars.charAt(Math.floor(Math.random() * chars.length));
            return codigo;
        }

        function copiarCodigoReferido() {
            navigator.clipboard.writeText(document.getElementById('miCodigoReferido').textContent);
            mostrarToast('¬°C√≥digo copiado!', 'success');
        }

        // Rifas
        async function cargarRifas() {
            const snapshot = await db.collection('rifas').where('activa', '==', true).get();
            rifas = [];
            snapshot.forEach(doc => rifas.push({ id: doc.id, ...doc.data() }));
            if (rifas.length === 0) await crearRifaInicial();
            renderizarRifas();
        }

        async function crearRifaInicial() {
            const rifa = {
                titulo: "$100 USD en Efectivo",
                descripcion: "¬°Compra tu boleto por $1 y gana $100!",
                icono: "üíµ", premio: 100, precioBoleto: 1,
                totalBoletos: 100, boletosVendidos: 0, dias: 7,
                activa: true, finalizada: false,
                fechaCreacion: firebase.firestore.FieldValue.serverTimestamp()
            };
            const docRef = await db.collection('rifas').add(rifa);
            rifas.push({ id: docRef.id, ...rifa });
        }

        function renderizarRifas() {
            const grid = document.getElementById('rifasGrid');
            if (rifas.length === 0) { grid.innerHTML = '<p style="text-align: center; opacity: 0.7;">No hay rifas activas</p>'; return; }
            grid.innerHTML = rifas.map(r => {
                const progreso = (r.boletosVendidos / r.totalBoletos) * 100;
                const disponibles = r.totalBoletos - r.boletosVendidos;
                return `
                    <div class="rifa-card">
                        <div class="rifa-image">${r.icono || 'üéÅ'}<span class="rifa-badge">üî• Activa</span></div>
                        <div class="rifa-content">
                            <h3 class="rifa-title">${r.titulo}</h3>
                            <p class="rifa-description">${r.descripcion || ''}</p>
                            <div class="rifa-stats">
                                <div class="stat"><div class="stat-value">$${r.precioBoleto || 1}</div><div class="stat-label">Boleto</div></div>
                                <div class="stat"><div class="stat-value">$${r.premio}</div><div class="stat-label">Premio</div></div>
                                <div class="stat"><div class="stat-value">${disponibles}</div><div class="stat-label">Disp.</div></div>
                            </div>
                            <div class="progress-bar"><div class="progress-fill" style="width: ${progreso}%"></div></div>
                            <button class="btn-participar" onclick="abrirModalParticipar('${r.id}')" ${disponibles <= 0 ? 'disabled' : ''}>${disponibles <= 0 ? 'Agotada' : 'üéüÔ∏è Comprar'}</button>
                        </div>
                    </div>`;
            }).join('');
        }

        // Ganadores
        async function cargarGanadores() {
            const snapshot = await db.collection('ganadores').orderBy('fecha', 'desc').limit(5).get();
            const lista = document.getElementById('ganadoresList');
            if (snapshot.empty) { lista.innerHTML = '<p style="text-align: center; opacity: 0.7;">Pr√≥ximamente ganadores</p>'; return; }
            lista.innerHTML = '';
            snapshot.forEach(doc => {
                const g = doc.data();
                lista.innerHTML += `<div class="ganador-item"><div class="ganador-icon">${g.icono || 'üèÜ'}</div><div class="ganador-info"><div class="ganador-nombre">${g.nombre}</div><div class="ganador-premio">Gan√≥: ${g.premio}</div></div></div>`;
            });
        }

        // Compra
        function abrirModalParticipar(rifaId) {
            if (!currentUser) { mostrarToast('Debes iniciar sesi√≥n', 'error'); abrirModal('modalLogin'); return; }
            rifaSeleccionada = rifas.find(r => r.id === rifaId);
            if (!rifaSeleccionada) return;
            cantidadBoletos = 1;
            document.getElementById('modalParticiparTitle').textContent = `üéüÔ∏è ${rifaSeleccionada.titulo}`;
            actualizarDisplayBoletos();
            abrirModal('modalParticipar');
        }

        function cambiarCantidadBoletos(delta) {
            const disponibles = rifaSeleccionada.totalBoletos - rifaSeleccionada.boletosVendidos;
            cantidadBoletos = Math.max(1, Math.min(cantidadBoletos + delta, disponibles));
            actualizarDisplayBoletos();
        }

        function actualizarDisplayBoletos() {
            document.getElementById('cantidadBoletosDisplay').textContent = cantidadBoletos;
            document.getElementById('totalPagarBoletos').textContent = `$${(cantidadBoletos * PRECIO_BOLETO).toFixed(2)}`;
        }

        async function confirmarCompra() {
            if (!currentUser || !rifaSeleccionada) return;
            const btn = document.getElementById('btnConfirmarCompra');
            btn.disabled = true;
            btn.textContent = 'Procesando...';

            try {
                const compra = {
                    usuarioId: currentUser.uid,
                    usuarioNombre: `${userData.nombre} ${userData.apellido}`,
                    usuarioEmail: userData.email,
                    rifaId: rifaSeleccionada.id,
                    rifaTitulo: rifaSeleccionada.titulo,
                    cantidad: cantidadBoletos,
                    precioUnitario: PRECIO_BOLETO,
                    total: cantidadBoletos * PRECIO_BOLETO,
                    referidorId: userData.referidoPor || null,
                    fecha: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('compras').add(compra);
                await db.collection('rifas').doc(rifaSeleccionada.id).update({
                    boletosVendidos: firebase.firestore.FieldValue.increment(cantidadBoletos)
                });
                if (userData.referidoPor) {
                    await db.collection('usuarios').doc(userData.referidoPor).update({
                        boletosDeReferidos: firebase.firestore.FieldValue.increment(cantidadBoletos),
                        dineroDeReferidos: firebase.firestore.FieldValue.increment(cantidadBoletos * COMISION_REFERIDO)
                    });
                }
                cerrarModal('modalParticipar');
                mostrarToast(`¬°Compraste ${cantidadBoletos} boleto(s)!`, 'success');
                await cargarRifas();
            } catch (error) {
                mostrarToast('Error al comprar', 'error');
            }
            btn.disabled = false;
            btn.textContent = 'Confirmar Compra';
        }

        // Profile
        async function cambiarAvatar(event) {
            const file = event.target.files[0];
            if (!file || !currentUser) return;
            mostrarToast('Subiendo...', 'success');
            const storageRef = storage.ref(`avatars/${currentUser.uid}`);
            await storageRef.put(file);
            const url = await storageRef.getDownloadURL();
            await db.collection('usuarios').doc(currentUser.uid).update({ avatarUrl: url });
            userData.avatarUrl = url;
            actualizarUIUsuario();
            document.getElementById('profileAvatarContent').innerHTML = `<img src="${url}">`;
            mostrarToast('¬°Avatar actualizado!', 'success');
        }

        async function actualizarPerfil(e) {
            e.preventDefault();
            const nombre = document.getElementById('editNombre').value.trim();
            const apellido = document.getElementById('editApellido').value.trim();
            await db.collection('usuarios').doc(currentUser.uid).update({ nombre, apellido });
            userData.nombre = nombre;
            userData.apellido = apellido;
            actualizarUIUsuario();
            cerrarModal('modalPerfil');
            mostrarToast('¬°Perfil actualizado!', 'success');
        }

        // Modal loaders
        async function cargarModalPerfil() {
            if (!userData) return;
            document.getElementById('profileNombreCompleto').textContent = `${userData.nombre} ${userData.apellido}`;
            document.getElementById('profileEmail').textContent = userData.email;
            document.getElementById('editNombre').value = userData.nombre || '';
            document.getElementById('editApellido').value = userData.apellido || '';
            document.getElementById('editTelefono').value = userData.telefono || '';
            document.getElementById('profileAvatarContent').innerHTML = userData.avatarUrl ? `<img src="${userData.avatarUrl}">` : (userData.nombre ? userData.nombre.charAt(0).toUpperCase() : 'üë§');
        }

        async function cargarModalEstadisticas() {
            if (!currentUser) return;
            const comprasQuery = await db.collection('compras').where('usuarioId', '==', currentUser.uid).get();
            let totalBoletos = 0, totalGastado = 0, rifasSet = new Set();
            comprasQuery.forEach(doc => {
                const d = doc.data();
                totalBoletos += d.cantidad || 0;
                totalGastado += d.total || 0;
                rifasSet.add(d.rifaId);
            });
            document.getElementById('statBoletosComprados').textContent = totalBoletos;
            document.getElementById('statDineroGastado').textContent = `$${totalGastado.toFixed(2)}`;
            document.getElementById('statRifasParticipadas').textContent = rifasSet.size;
        }

        async function cargarModalMisBoletos() {
            if (!currentUser) return;
            const lista = document.getElementById('listaMisBoletos');
            lista.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            const comprasQuery = await db.collection('compras').where('usuarioId', '==', currentUser.uid).orderBy('fecha', 'desc').get();
            if (comprasQuery.empty) { lista.innerHTML = '<p style="text-align: center; opacity: 0.7;">No tienes boletos</p>'; return; }
            lista.innerHTML = '';
            comprasQuery.forEach(doc => {
                const c = doc.data();
                const fecha = c.fecha ? new Date(c.fecha.toDate()).toLocaleDateString() : 'N/A';
                lista.innerHTML += `<div class="ganador-item" style="border-color: var(--primary); background: rgba(255, 107, 53, 0.1);"><div class="ganador-icon">üéüÔ∏è</div><div class="ganador-info"><div class="ganador-nombre">${c.rifaTitulo}</div><div class="ganador-premio">${c.cantidad} boleto(s) - $${c.total} - ${fecha}</div></div></div>`;
            });
        }

        async function cargarModalReferidos() {
            if (!userData) return;
            document.getElementById('miCodigoReferido').textContent = userData.codigoReferido || '------';
            const referidosQuery = await db.collection('usuarios').where('referidoPor', '==', currentUser.uid).get();
            document.getElementById('totalReferidos').textContent = referidosQuery.size;
            const comprasQuery = await db.collection('compras').where('referidorId', '==', currentUser.uid).get();
            let totalBoletos = 0;
            comprasQuery.forEach(doc => totalBoletos += doc.data().cantidad || 0);
            document.getElementById('boletosReferidos').textContent = totalBoletos;
            document.getElementById('dineroReferidos').textContent = `$${(totalBoletos * COMISION_REFERIDO).toFixed(2)}`;
        }

        // Admin
        function mostrarPanelAdmin() {
            if (!userData || (userData.email !== ADMIN_EMAIL && !userData.esAdmin)) { mostrarToast('Sin permisos', 'error'); return; }
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('userDropdown').classList.remove('show');
            cargarDashboardAdmin();
        }

        function cerrarPanelAdmin() {
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('adminPanel').classList.remove('active');
        }

        function cambiarTabAdmin(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(c => c.style.display = 'none');
            event.target.classList.add('active');
            document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1)).style.display = 'block';
            if (tab === 'dashboard') cargarDashboardAdmin();
            if (tab === 'rifas') cargarRifasAdmin();
            if (tab === 'usuarios') cargarUsuariosAdmin();
            if (tab === 'compras') cargarComprasAdmin();
        }

        async function cargarDashboardAdmin() {
            const [usuariosSnap, rifasSnap, comprasSnap] = await Promise.all([
                db.collection('usuarios').get(),
                db.collection('rifas').where('activa', '==', true).get(),
                db.collection('compras').get()
            ]);
            let totalBoletos = 0, totalIngresos = 0, totalComisiones = 0;
            comprasSnap.forEach(doc => {
                const d = doc.data();
                totalBoletos += d.cantidad || 0;
                totalIngresos += d.total || 0;
                if (d.referidorId) totalComisiones += (d.cantidad || 0) * COMISION_REFERIDO;
            });
            document.getElementById('adminTotalUsuarios').textContent = usuariosSnap.size;
            document.getElementById('adminTotalRifas').textContent = rifasSnap.size;
            document.getElementById('adminTotalBoletos').textContent = totalBoletos;
            document.getElementById('adminTotalIngresos').textContent = `$${totalIngresos.toFixed(2)}`;
            document.getElementById('adminTotalReferidos').textContent = `$${totalComisiones.toFixed(2)}`;
        }

        async function cargarRifasAdmin() {
            const tbody = document.getElementById('rifasAdminBody');
            tbody.innerHTML = '<tr><td colspan="5"><div class="spinner" style="margin: 1rem auto;"></div></td></tr>';
            const snapshot = await db.collection('rifas').get();
            tbody.innerHTML = '';
            snapshot.forEach(doc => {
                const r = { id: doc.id, ...doc.data() };
                const status = r.activa ? 'active' : 'inactive';
                tbody.innerHTML += `<tr><td>${r.icono || 'üéÅ'} ${r.titulo}</td><td>$${r.premio}</td><td>${r.boletosVendidos || 0}/${r.totalBoletos}</td><td><span class="status-badge status-${status}">${r.activa ? 'Activa' : 'Inactiva'}</span></td><td><button class="btn-small btn-edit" onclick="editarRifaAdmin('${r.id}')">Editar</button><button class="btn-small btn-toggle" onclick="toggleRifaAdmin('${r.id}', ${r.activa})">${r.activa ? 'Desact.' : 'Activar'}</button><button class="btn-small btn-delete" onclick="eliminarRifaAdmin('${r.id}')">Eliminar</button></td></tr>`;
            });
        }

        async function cargarUsuariosAdmin() {
            const tbody = document.getElementById('usuariosAdminBody');
            tbody.innerHTML = '<tr><td colspan="5"><div class="spinner" style="margin: 1rem auto;"></div></td></tr>';
            const snapshot = await db.collection('usuarios').orderBy('fechaRegistro', 'desc').get();
            tbody.innerHTML = '';
            snapshot.forEach(doc => {
                const u = doc.data();
                const fecha = u.fechaRegistro ? new Date(u.fechaRegistro.toDate()).toLocaleDateString() : 'N/A';
                tbody.innerHTML += `<tr><td>${u.nombre} ${u.apellido}</td><td>${u.email}</td><td>${u.telefono || 'N/A'}</td><td>${u.totalReferidos || 0}</td><td>${fecha}</td></tr>`;
            });
        }

        async function cargarComprasAdmin() {
            const tbody = document.getElementById('comprasAdminBody');
            tbody.innerHTML = '<tr><td colspan="6"><div class="spinner" style="margin: 1rem auto;"></div></td></tr>';
            const snapshot = await db.collection('compras').orderBy('fecha', 'desc').limit(50).get();
            tbody.innerHTML = '';
            snapshot.forEach(doc => {
                const c = doc.data();
                const fecha = c.fecha ? new Date(c.fecha.toDate()).toLocaleDateString() : 'N/A';
                tbody.innerHTML += `<tr><td>${c.usuarioNombre}</td><td>${c.rifaTitulo}</td><td>${c.cantidad}</td><td>$${c.total}</td><td>${c.referidorId ? '‚úÖ' : '‚ùå'}</td><td>${fecha}</td></tr>`;
            });
        }

        async function guardarRifa(e) {
            e.preventDefault();
            const datos = {
                titulo: document.getElementById('rifaTitulo').value,
                descripcion: document.getElementById('rifaDescripcion').value,
                icono: document.getElementById('rifaIcono').value,
                premio: parseFloat(document.getElementById('rifaPremio').value),
                precioBoleto: PRECIO_BOLETO,
                totalBoletos: parseInt(document.getElementById('rifaTotalBoletos').value),
                dias: parseInt(document.getElementById('rifaDias').value)
            };
            if (rifaEditando) {
                await db.collection('rifas').doc(rifaEditando).update(datos);
            } else {
                datos.boletosVendidos = 0;
                datos.activa = true;
                datos.finalizada = false;
                datos.fechaCreacion = firebase.firestore.FieldValue.serverTimestamp();
                await db.collection('rifas').add(datos);
            }
            cerrarModal('modalNuevaRifa');
            rifaEditando = null;
            cargarRifasAdmin();
            cargarRifas();
            mostrarToast('Rifa guardada', 'success');
        }

        async function editarRifaAdmin(id) {
            const doc = await db.collection('rifas').doc(id).get();
            if (!doc.exists) return;
            const r = doc.data();
            rifaEditando = id;
            document.getElementById('modalRifaTitle').textContent = '‚úèÔ∏è Editar Rifa';
            document.getElementById('rifaTitulo').value = r.titulo;
            document.getElementById('rifaDescripcion').value = r.descripcion || '';
            document.getElementById('rifaIcono').value = r.icono || 'üéÅ';
            document.getElementById('rifaPremio').value = r.premio;
            document.getElementById('rifaTotalBoletos').value = r.totalBoletos;
            document.getElementById('rifaDias').value = r.dias || 7;
            abrirModal('modalNuevaRifa');
        }

        async function toggleRifaAdmin(id, activa) {
            await db.collection('rifas').doc(id).update({ activa: !activa });
            cargarRifasAdmin();
            cargarRifas();
            mostrarToast(`Rifa ${activa ? 'desactivada' : 'activada'}`, 'success');
        }

        async function eliminarRifaAdmin(id) {
            if (!confirm('¬øEliminar rifa?')) return;
            await db.collection('rifas').doc(id).delete();
            cargarRifasAdmin();
            cargarRifas();
            mostrarToast('Rifa eliminada', 'success');
        }

        // Utils
        function abrirModal(id) {
            document.getElementById(id).classList.add('active');
            if (id === 'modalPerfil') cargarModalPerfil();
            if (id === 'modalEstadisticas') cargarModalEstadisticas();
            if (id === 'modalMisBoletos') cargarModalMisBoletos();
            if (id === 'modalReferidos') cargarModalReferidos();
            if (id === 'modalNuevaRifa' && !rifaEditando) {
                document.getElementById('modalRifaTitle').textContent = '‚ûï Nueva Rifa';
                document.querySelector('#modalNuevaRifa form').reset();
                document.getElementById('rifaIcono').value = 'üéÅ';
                document.getElementById('rifaPremio').value = '100';
                document.getElementById('rifaTotalBoletos').value = '100';
                document.getElementById('rifaDias').value = '7';
            }
        }

        function cerrarModal(id) {
            document.getElementById(id).classList.remove('active');
            if (id === 'modalNuevaRifa') rifaEditando = null;
        }

        function cambiarModal(cerrar, abrir) {
            cerrarModal(cerrar);
            setTimeout(() => abrirModal(abrir), 200);
        }

        function toggleUserDropdown() {
            event.stopPropagation();
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function irInicio() {
            cerrarPanelAdmin();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function mostrarToast(msg, tipo = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;
            toast.innerHTML = `<span>${tipo === 'success' ? '‚úÖ' : '‚ùå'}</span> ${msg}`;
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.animation = 'slideInRight 0.3s ease reverse'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.classList.remove('active'); });
        });

        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });
    </script>
</body>
</html>
